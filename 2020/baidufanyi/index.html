<!DOCTYPE html>
<html lang="zh-cn">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="Wanakiki">
  
  
  
  <link rel="prev" href="https://wanakiki.github.io/2020/leetcode-spider/" />
  <link rel="next" href="https://wanakiki.github.io/2020/mongodb-demo/" />
  <link rel="canonical" href="https://wanakiki.github.io/2020/baidufanyi/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           ç™¾åº¦ç¿»è¯‘çˆ¬è™« | Wanakiki`s Blog
       
  </title>
  <meta name="title" content="ç™¾åº¦ç¿»è¯‘çˆ¬è™« | Wanakiki`s Blog">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/wanakiki.github.io"
    },
    "articleSection" : "posts",
    "name" : "ç™¾åº¦ç¿»è¯‘çˆ¬è™«",
    "headline" : "ç™¾åº¦ç¿»è¯‘çˆ¬è™«",
    "description" : "å…¸å‹çš„jsåŠ å¯†çˆ¬è™«å®æˆ˜ï¼Œæœ¬æ–‡ç« å†…å®¹ä»…ä½œå­¦ä¹ äº¤æµã€‚ é¦–å…ˆæ”¾ä¸€ä¸‹å‚è€ƒæ–‡ç« ï¼šçˆ¬è™«JSç ´è§£ç»å…¸æ¡ˆä¾‹ä¹‹ç™¾åº¦ç¿»è¯‘ å¦‚æœæ²¡æœ‰è¿™ç¯‡æ–‡ç« çš„è¯ï¼Œæˆ‘å¯èƒ½è¦èŠ±å¾ˆå¤šåŠŸå¤«æ‰",
    "inLanguage" : "zh-cn",
    "author" : "Wanakiki",
    "creator" : "Wanakiki",
    "publisher": "Wanakiki",
    "accountablePerson" : "Wanakiki",
    "copyrightHolder" : "Wanakiki",
    "copyrightYear" : "2020",
    "datePublished": "2020-05-18 20:44:50 \x2b0800 CST",
    "dateModified" : "2020-05-18 20:44:50 \x2b0800 CST",
    "url" : "https:\/\/wanakiki.github.io\/2020\/baidufanyi\/",
    "wordCount" : "3375",
    "keywords" : [ "Python","çˆ¬è™«", "Wanakiki`s Blog"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://wanakiki.github.io">Wanakiki`s Blog</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://wanakiki.github.io">Wanakiki`s Blog</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">ç™¾åº¦ç¿»è¯‘çˆ¬è™«</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://wanakiki.github.io" rel="author">Wanakiki</a> with â™¥ 
                <span class="post-time">
                on <time datetime=2020-05-18 itemprop="datePublished">May 18, 2020</time>
                </span>
                in
                
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          

<p>å…¸å‹çš„jsåŠ å¯†çˆ¬è™«å®æˆ˜ï¼Œæœ¬æ–‡ç« å†…å®¹ä»…ä½œå­¦ä¹ äº¤æµã€‚</p>

<!-- more -->

<p>é¦–å…ˆæ”¾ä¸€ä¸‹å‚è€ƒæ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/76239929" rel="nofollow noreferrer" target="_blank">çˆ¬è™«JSç ´è§£ç»å…¸æ¡ˆä¾‹ä¹‹ç™¾åº¦ç¿»è¯‘</a></p>

<p>å¦‚æœæ²¡æœ‰è¿™ç¯‡æ–‡ç« çš„è¯ï¼Œæˆ‘å¯èƒ½è¦èŠ±å¾ˆå¤šåŠŸå¤«æ‰èƒ½æ‰¾åˆ°å…·ä½“çš„jsä»£ç ä½ç½®ã€‚</p>

<h2 id="é¡µé¢åŠ è½½åˆ†æ">é¡µé¢åŠ è½½åˆ†æ</h2>

<h3 id="åˆæ­¥æ¢ç´¢">åˆæ­¥æ¢ç´¢</h3>

<p>æ‰“å¼€<a href="https://fanyi.baidu.com/" rel="nofollow noreferrer" target="_blank">ç™¾åº¦ç¿»è¯‘</a>ï¼Œç„¶åå³é”®ã€æ£€æŸ¥ã€networkï¼Œåˆ·æ–°é¡µé¢å³å¯çœ‹åˆ°ç½‘é¡µçš„åŠ è½½è¿‡ç¨‹ã€‚å…·ä½“çš„å›¾ç¤ºå¯ä»¥åœ¨ä¹‹å‰çš„<a href="../leetcode-spider">leetcodeçˆ¬è™«</a>ä¸­æ‰¾åˆ°ã€‚</p>

<p>åœ¨è¾“å…¥ä»»æ„æŸ¥è¯¢å†…å®¹ç‚¹å‡»ç¿»è¯‘åï¼Œåœ¨<code>XHR</code>é¡¹ä¸­å¯ä»¥çœ‹åˆ°<code>langdetect</code>ã€<code>v2transapi?form &amp; to</code>ä¸¤ä¸ªè¯·æ±‚ã€‚æ£€æŸ¥å†…å®¹ä¸éš¾å‘ç°ï¼Œå‰è€…çš„ä½œç”¨æ˜¯è¯­è¨€æ£€æŸ¥ï¼Œ åè€…æ‰æ˜¯çœŸæ­£çš„ç¿»è¯‘ã€‚</p>

<pre><code class="language-no">from: en
to: zh
query: hello everyone
transtype: translang
simple_means_flag: 3
sign: 58244.262325
token: 440bdb196410660e636b3223ebb83a94
domain: common
</code></pre>

<p>ä¸Šé¢æ˜¯æˆ‘ä»¥&rdquo;hello everyone&rdquo;ä½œä¸ºå¾…ç¿»è¯‘æ–‡æœ¬å‘èµ·è¯·æ±‚çš„è¡¨å•å†…å®¹ï¼Œ<code>from</code>ã€<code>to</code>ã€<code>query</code>è¿™ä¸‰é¡¹æ„ä¹‰å¾ˆæ˜ç¡®ï¼Œå…¶ä½™é¡¹æ— æ³•ç›´æ¥åˆ¤æ–­å‡ºå…·ä½“çš„ä½œç”¨ã€‚</p>

<h3 id="æ·±å…¥æŒ–æ˜">æ·±å…¥æŒ–æ˜</h3>

<p>å¤šè¾“å…¥å‡ ç»„æ•°æ®ï¼Œå¯ä»¥å‘ç°<code>sign</code>ä¼šéšç€<code>query</code>çš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œè€Œ<code>token</code>é¡¹å´ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚</p>

<p>è¿™é‡Œæˆ‘å‚è€ƒäº†åˆ«äººçš„æ–¹å¼ï¼Œæœç´¢&rdquo;sign:&ldquo;å¾ˆå¿«æ‰¾åˆ°äº†è¿™ä¸ªè¯·æ±‚çš„å‘èµ·ä»£ç ï¼š</p>

<pre><code class="language-js">h={from:p.fromLang,to:p.toLang,query:n,transtype:r,simple_means_flag:3,sign:y(n),token:window.common.token,domain:w.getCurDomain()}
</code></pre>

<p>å¦å¤–è¿™é‡Œçš„<code>token</code>ä¹Ÿå¯ä»¥é€šè¿‡æœç´¢&rdquo;window[&lsquo;common&rsquo;]&ldquo;æ‰¾åˆ°ï¼Œå‘ç°ä»–å…¶å®ä½äºhtmlä»£ç ä¸­ï¼Œæ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œå¯ä»¥ç›´æ¥ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£æhtmlä»£ç è·å–ã€‚æ‰€ä»¥ç°åœ¨éœ€è¦è§£å†³çš„é—®é¢˜å°±æ˜¯<code>sign</code>çš„äº§ç”Ÿã€‚</p>

<h2 id="jsç ´è§£">JSç ´è§£</h2>

<p><code>sign</code>é€šè¿‡yå‡½æ•°äº§ç”Ÿï¼Œå¦å¤–é€šè¿‡è§‚å¯Ÿå¯ä»¥å‘ç°yå‡½æ•°çš„ä¼ å‚å®é™…ä¸Šæ˜¯å¾…æŸ¥è¯¢çš„å†…å®¹ï¼Œæ‰€ä»¥åªè¦æ‰¾åˆ°yå‡½æ•°ï¼Œç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥è·å¾—ä»»æ„è¾“å…¥çš„<code>sign</code>å€¼ã€‚é‚£ä¹ˆæ€ä¹ˆæ‰èƒ½æ‰¾åˆ°yå‡½æ•°å‘¢ï¼Ÿç¬¬ä¸€ä¸ªæƒ³æ³•å½“ç„¶æ˜¯ç»§ç»­æœç´¢ï¼Œä½†å®é™…ä¸Šä¸€æœç´¢å°±ä¼šå‘ç°ï¼Œå› ä¸ºç‰¹å¾å¤ªå°‘æ— æ³•ç¡®å®šå…·ä½“æ˜¯å“ªä¸€ä¸ªæœç´¢ç»“æœã€‚è¿™é‡Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªå¾ˆå…³é”®çš„æŠ€æœ¯ï¼š<code>JSè°ƒè¯•</code>ã€‚</p>

<h3 id="jsè°ƒè¯•">JSè°ƒè¯•</h3>

<p>å…ˆè¯´ä¸€ä¸‹è°ƒè¯•çš„å…·ä½“æ­¥éª¤ï¼Œå¦‚æœæ²¡æœ‰ç›¸å…³åŸºç¡€çš„è¯ç›´æ¥ä¸Šæ‰‹è¿˜æ˜¯ä¼šæœ‰ç‚¹é—®é¢˜çš„ã€‚</p>

<p>é¦–å…ˆæ‰¾åˆ°ä»£ç æ‰€åœ¨è¡Œï¼Œå¯¹äºå¤æ‚ç½‘é¡µï¼Œä¸€è¡Œå†…å¯èƒ½æœ‰å¤šæ¡è¯­å¥ï¼Œè¿™æ—¶å€™å¦‚æœç›´æ¥ç‚¹å‡»æƒ³è¦è°ƒè¯•çš„å‡½æ•°çš„è¯ï¼Œå®é™…ä¸Šä¸ä¼šæ·»åŠ æ–­ç‚¹ã€‚æ­£ç¡®çš„æ“ä½œåº”è¯¥æ˜¯åƒPythonä»£ç é‚£æ ·ï¼Œå…ˆç‚¹å‡»è¿™ä¸€è¡Œçš„æœ€å·¦ä¾§çš„è¡Œå·ï¼Œç‚¹å‡»è¡Œå·ä¹‹ååœ¨æŠŠé¼ æ ‡ç§»åŠ¨åˆ°æƒ³è¦è°ƒè¯•çš„å‡½æ•°ä¸Šï¼Œè¿™æ—¶å€™ä¼šå‘ç°å‡½æ•°å¯ä»¥è¢«ç‚¹å‡»ï¼Œç‚¹å‡»å‡½æ•°åä¾¿èƒ½æ·»åŠ æ–­ç‚¹ã€‚ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ç‚¹å‡»ä»£ç æ¡†å·¦ä¸‹è§’çš„èŠ±æ‹¬å·ï¼Œç›´æ¥æŠŠä»£ç æ ¼å¼åŒ–ï¼Œæˆ‘å½“æ—¶æ‰¾äº†å¾ˆä¹…æ²¡æ‰¾åˆ°ğŸ˜£ï¼‰</p>

<p>åœ¨æ·»åŠ å®Œæ–­ç‚¹ä¹‹åï¼Œç»§ç»­è¾“å…¥å†…å®¹ï¼Œç‚¹å‡»ç¿»è¯‘ï¼Œå¯ä»¥å‘ç°ç½‘ç«™åœæ­¢åŠ è½½ï¼Œå¹¶ä¸”è¿”å›è°ƒè¯•ç•Œé¢å¯ä»¥çœ‹åˆ°å˜é‡ååŠå…¶å¯¹åº”çš„å€¼ï¼Œå°†é¼ æ ‡æ”¾åˆ°å‡½æ•°åä¸Šå¯ä»¥è·³è½¬åˆ°å‡½æ•°çš„å…·ä½“ä½ç½®ï¼Œè¿™æ ·å°±èƒ½æ‰¾åˆ°yå‡½æ•°çš„çœŸæ­£ä½ç½®äº†ã€‚å…¶å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p>

<pre><code class="language-js">function e(r) {
    var o = r.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g);
    if (null === o) {
        var t = r.length;
        t &gt; 30 &amp;&amp; (r = &quot;&quot; + r.substr(0, 10) + r.substr(Math.floor(t / 2) - 5, 10) + r.substr(-10, 10))
    } else {
        for (var e = r.split(/[\uD800-\uDBFF][\uDC00-\uDFFF]/), C = 0, h = e.length, f = []; h &gt; C; C++)&quot;&quot; !== e[C] &amp;&amp; f.push.apply(f, a(e[C].split(&quot;&quot;))), C !== h - 1 &amp;&amp; f.push(o[C]);
        var g = f.length; g &gt; 30 &amp;&amp; (r = f.slice(0, 10).join(&quot;&quot;) + f.slice(Math.floor(g / 2) - 5, Math.floor(g / 2) + 5).join(&quot;&quot;) + f.slice(-10).join(&quot;&quot;))
    }
    var i = null;   // ç›´æ¥æ‰§è¡Œä¼šæç¤ºiæ²¡æœ‰å®šä¹‰ æ‰€ä»¥åŠ äº†ä¸€è¡Œ
    var u = void 0, l = &quot;&quot; + String.fromCharCode(103) + String.fromCharCode(116) + String.fromCharCode(107); 
    u = null !== i ? i : (i = window[l] || &quot;&quot;) || &quot;&quot;;
    for (var d = u.split(&quot;.&quot;), m = Number(d[0]) || 0, s = Number(d[1]) || 0, S = [], c = 0, v = 0; v &lt; r.length; v++) {
        var A = r.charCodeAt(v); 128 &gt; A ? S[c++] = A : (2048 &gt; A ? S[c++] = A &gt;&gt; 6 | 192 : (55296 === (64512 &amp; A) &amp;&amp; v + 1 &lt; r.length &amp;&amp; 56320 === (64512 &amp; r.charCodeAt(v + 1)) ? (A = 65536 + ((1023 &amp; A) &lt;&lt; 10) + (1023 &amp; r.charCodeAt(++v)), S[c++] = A &gt;&gt; 18 | 240, S[c++] = A &gt;&gt; 12 &amp; 63 | 128) : S[c++] = A &gt;&gt; 12 | 224, S[c++] = A &gt;&gt; 6 &amp; 63 | 128), S[c++] = 63 &amp; A | 128)
    } for (var p = m, F = &quot;&quot; + String.fromCharCode(43) + String.fromCharCode(45) + String.fromCharCode(97) + (&quot;&quot; + String.fromCharCode(94) + String.fromCharCode(43) + String.fromCharCode(54)), D = &quot;&quot; + String.fromCharCode(43) + String.fromCharCode(45) + String.fromCharCode(51) + (&quot;&quot; + String.fromCharCode(94) + String.fromCharCode(43) + String.fromCharCode(98)) + (&quot;&quot; + String.fromCharCode(43) + String.fromCharCode(45) + String.fromCharCode(102)), b = 0; b &lt; S.length; b++)p += S[b], p = n(p, F);
    return p = n(p, D), p ^= s, 0 &gt; p &amp;&amp; (p = (2147483647 &amp; p) + 2147483648), p %= 1e6, p.toString() + &quot;.&quot; + (p ^ m)
}
</code></pre>

<p>å¯ä»¥çœ‹åˆ°è¿™æ®µä»£ç è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå¦‚æœæ‡‚jsçš„è¯ï¼Œå¯ä»¥ç¨å¾®è§£è¯»ä¸€ä¸‹ï¼Œå› ä¸ºè¿™æ®µä»£ç è¿˜æ²¡æœ‰æ··æ·†åˆ°å®Œå…¨æ²¡åŠæ³•çœ‹çš„ç¨‹åº¦ï¼ˆæŠŠæ‰€æœ‰çš„å­—ç¬¦éƒ½ç”¨æ‹¬å·æˆ–è€…ä¸‹åˆ’çº¿ä¹‹ç±»çš„æ›¿ä»£ï¼‰ã€‚</p>

<p>è¿™é‡Œè®²ä¸‰ä¸ªåç»­æ‰§è¡Œä»£ç çš„æ—¶å€™æ‰ä¼šå‘ç°çš„ç‚¹ï¼š</p>

<ol>
<li>ä»£ç ä½¿ç”¨äº†å…¨å±€çš„<code>window</code>å˜é‡ï¼Œjså‡½æ•°å½“ä¸­æœªä½œå®šä¹‰ï¼Œé€šè¿‡è°ƒè¯•å¯ä»¥å‘ç°å®é™…ä¸Šæ˜¯ä¸ºäº†è·å–è¯¥å˜é‡çš„<code>gtk</code>å€¼ï¼Œè¯¥å€¼ä¹Ÿæ˜¯å†™åœ¨htmlå½“ä¸­çš„ï¼Œå¯ä»¥ç›´æ¥æ­£åˆ™è·å¾—ï¼Œè·å¾—ä¹‹åå¯¹jsä»£ç è¿›è¡Œç¨å¾®ä¿®æ”¹å³å¯ã€‚</li>
<li>iå˜é‡æœªå®šä¹‰ï¼Œæ²¡æœ‰æ‰¾åˆ°iå˜é‡çš„å…·ä½“ä½ç½®ï¼Œä½†æ˜¯æŸ¥çœ‹ä¹‹åå…¶æ²¡æœ‰å¾ˆçªå‡ºçš„ä½œç”¨ï¼Œäºæ˜¯è‡ªå·±åŠ äº†ä¸€æ¡è¯­å¥ï¼Œå¯¹iå˜é‡è¿›è¡Œäº†å®šä¹‰ã€‚</li>
<li>å‡½æ•°å†…éƒ¨è°ƒç”¨äº†å¦å¤–çš„å‡½æ•°nğŸ˜‘ï¼Œå…·ä½“çš„è°ƒç”¨å¯ä»¥åœ¨å‡½æ•°çš„returnä½ç½®ï¼Œå¦‚æœä¸ä»”ç»†çœ‹è¿‡ï¼Œç¬¬ä¸€éæ˜¯ä¸ä¼šå‘ç°è¿™ä¸ªç‚¹çš„ã€‚æ‰¾åˆ°nçš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥æ‰“æ–­ç‚¹å°±å¥½äº†ï¼Œè¿™é‡Œä¸åšè¯¦ç»†è§£é‡Šã€‚nçš„ä»£ç ä¼šåœ¨æœ€åç»™å‡ºã€‚</li>
</ol>

<h3 id="pythonæ‰§è¡Œjsä»£ç ">Pythonæ‰§è¡ŒJSä»£ç </h3>

<p>å‰é¢æˆ‘ä»¬å·²ç»è·å¾—äº†<code>sign</code>ç”Ÿæˆå‡½æ•°çš„å…·ä½“ä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬çš„çˆ¬è™«è¯­è¨€æ˜¯Pythonï¼Œå¦‚æœæŠŠjsä»£ç ç¿»è¯‘æˆPythonå°±å¤ªéº»çƒ¦äº†ï¼Œè¿˜å¥½æœ‰å·²ç»å°è£…å¥½çš„ç¬¬ä¸‰æ–¹åº“å¯ä»¥æ‰§è¡Œã€‚</p>

<p>èƒ½å¤Ÿå®ç°ä¸Šè¿°åŠŸèƒ½çš„ç¬¬ä¸‰æ–¹åº“æœ‰å¾ˆå¤šï¼Œæˆ‘è¿™é‡Œä½¿ç”¨äº†<code>pyexecjs</code>ï¼Œéœ€è¦æ³¨æ„è¯¥æ¨¡å—éœ€è¦å®‰è£…node.jsé…åˆä½¿ç”¨ã€‚å‡è®¾æˆ‘ä»¬å·²ç»æŠŠç”Ÿæˆå‡½æ•°æ”¾åœ¨äº†fanyi.jså½“ä¸­ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼è¿›è¡Œè°ƒç”¨ï¼š</p>

<pre><code class="language-python">import execjs

query = &quot;å¾…ç¿»è¯‘è¯­å¥&quot;
fh = open('fanyi.js', 'r')
fun = execjs.compile(fh.read())
print(fun.call('e', query))
</code></pre>

<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>

<p>åœ¨åšå®Œå‰é¢çš„å‡†å¤‡å·¥ä½œä¹‹åï¼Œä¾¿èƒ½å¼€å§‹å…·ä½“çš„ä»£ç ä¹¦å†™ï¼Œæ•´ä½“æ€è·¯å¦‚ä¸‹ï¼š</p>

<ol>
<li>è¯·æ±‚ç™¾åº¦ç¿»è¯‘é¦–é¡µ</li>
<li>è§£æhtmlè·å¾—<code>token</code>ã€<code>gtk</code></li>
<li>ç”¨å¾—åˆ°çš„<code>gkt</code>æ›¿æ¢jsä»£ç ä¸­çš„å¯¹åº”å†…å®¹</li>
<li>ç¼–è¯‘jsä»£ç å¹¶æ‰§è¡Œï¼Œè·å¾—<code>sign</code></li>
<li>è¯·æ±‚å…·ä½“çš„è¯­è¨€æ£€æµ‹ã€ç¿»è¯‘ç½‘å€ï¼Œå¾—åˆ°ç»“æœ</li>
</ol>

<p>åœ¨å®ç°çˆ¬è™«æ—¶ï¼Œæˆ‘åˆå¯¹æŸ¥è¯¢è¯·æ±‚åšäº†è¿›ä¸€æ­¥åˆ†æï¼Œå‘ç°åœ¨æäº¤çš„ä¼—å¤šcookieå½“ä¸­ï¼Œæœ€å…³é”®çš„æ˜¯<code>BAIDUID</code>è¿™ä¸€é¡¹ï¼Œè€Œè®¿é—®ç™¾åº¦ç¿»è¯‘é¦–é¡µåˆšå¥½å¯ä»¥è·å¾—è¿™ä¸ªcookieã€‚</p>

<p>è¿™æ ·ä¾¿èƒ½ç›´æ¥ç”¨ä¸€ä¸ªsessionï¼Œå…ˆè®¿é—®ç™¾åº¦ç¿»è¯‘é¦–é¡µï¼Œè·å¾—cookieçš„åŒæ—¶è§£æhtmlå¾—åˆ°<code>token</code>å’Œ<code>gtk</code>ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œã€‚åˆ°è¿™é‡Œä»£ç å·²ç»å¾ˆæ¸…æ™°äº†ï¼Œä½†æ˜¯å†™å®Œä¹‹åå´å‘ç°ä¸èƒ½æˆåŠŸæ‰§è¡Œï¼ŒæœåŠ¡ç«¯æŠ¥é”™998ğŸ˜­</p>

<p>çœ‹åˆ°é”™è¯¯ä¹‹åä»¥ä¸ºæ˜¯jsä»£ç å‡ºäº†é—®é¢˜ï¼Œè°ƒæ•´äº†å¾ˆä¹…ï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯ä¸è¡Œï¼Œäºæ˜¯åˆæ±‚åŠ©äº†ç™¾åº¦ï¼Œåœ¨<a href="https://www.cnblogs.com/jason-Gan/p/10567018.html" rel="nofollow noreferrer" target="_blank">è¿™é‡Œ</a>æ‰¾åˆ°äº†ä¸€ä¸ªè§£å†³åŠæ³•ï¼Œå…ˆè®¿é—®ä¸€ä¸‹ç™¾åº¦é¦–é¡µï¼Œå¸¦ç€ç™¾åº¦é¦–é¡µçš„cookieè®¿é—®ç™¾åº¦ç¿»è¯‘ï¼Œè¿™æ ·å°±ä¸ä¼šæŠ¥é”™ã€‚</p>

<p>å…·ä½“çš„åŸç†æˆ‘åˆ°ç°åœ¨è¿˜ä¸æ¸…æ¥šï¼Œæˆ‘ä¹‹å‰è¿›è¡Œæµ‹è¯•çš„æ—¶å€™ï¼Œå¦‚æœä¸å…ˆè®¿é—®ç™¾åº¦é¦–é¡µçš„è¯ï¼Œè®¿é—®ç™¾åº¦ç¿»è¯‘è§£æå‡ºæ¥çš„<code>token</code>æ˜¯ä¸€ä¸ªä¸€æˆä¸å˜çš„å€¼ï¼Œæˆ‘èµ·åˆè®¤ä¸ºæ˜¯jsä»£ç æœ‰é”™è¯¯ï¼Œå°±ä¸€ç›´è¿›è¡Œäº†æµ‹è¯•ï¼ŒåŠä¸ªå¤šå°æ—¶<code>token</code>çš„å€¼éƒ½æ²¡æœ‰å˜åŒ–ã€‚<code>token</code>æ˜¯åœ¨htmlå½“ä¸­å†™æ­»çš„ï¼Œæœ‰é—®é¢˜åªèƒ½å‡ºåœ¨æœåŠ¡ç«¯ä¸Šï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºå…ˆè®¿é—®ç™¾åº¦é¦–é¡µçš„ç›®çš„å°±æ˜¯åœ¨è®¿é—®ç™¾åº¦ç¿»è¯‘çš„æ—¶å€™å¸¦ç€ä¸€ä¸ªcookieï¼Œè®©æœåŠ¡å™¨è¿”å›htmlçš„æ—¶å€™ç”Ÿæˆæ­£ç¡®çš„<code>token</code>ã€‚è‡³äºå…·ä½“æ˜¯ä¸æ˜¯è¿™ä¸ªåŸå› ï¼Œç­‰å­¦çš„æ›´å¤šäº†æ‰çŸ¥é“ã€‚</p>

<p>ä¸‹é¢æ˜¯æˆ‘çš„ä»£ç ï¼š</p>

<pre><code class="language-python">import re
import requests
import execjs
import json


js_content = r&quot;&quot;&quot;function e(r) {
    var o = r.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g);
    if (null === o) {
        var t = r.length;
        t &gt; 30 &amp;&amp; (r = &quot;&quot; + r.substr(0, 10) + r.substr(Math.floor(t / 2) - 5, 10) + r.substr(-10, 10))
    } else {
        for (var e = r.split(/[\uD800-\uDBFF][\uDC00-\uDFFF]/), C = 0, h = e.length, f = []; h &gt; C; C++)&quot;&quot; !== e[C] &amp;&amp; f.push.apply(f, a(e[C].split(&quot;&quot;))), C !== h - 1 &amp;&amp; f.push(o[C]);
        var g = f.length; g &gt; 30 &amp;&amp; (r = f.slice(0, 10).join(&quot;&quot;) + f.slice(Math.floor(g / 2) - 5, Math.floor(g / 2) + 5).join(&quot;&quot;) + f.slice(-10).join(&quot;&quot;))
    }
    var i = null 
    var u = void 0, l = &quot;&quot; + String.fromCharCode(103) + String.fromCharCode(116) + String.fromCharCode(107); 
    u = null !== i ? i : (i = window[l] || &quot;&quot;) || &quot;&quot;;
    for (var d = u.split(&quot;.&quot;), m = Number(d[0]) || 0, s = Number(d[1]) || 0, S = [], c = 0, v = 0; v &lt; r.length; v++) {
        var A = r.charCodeAt(v); 128 &gt; A ? S[c++] = A : (2048 &gt; A ? S[c++] = A &gt;&gt; 6 | 192 : (55296 === (64512 &amp; A) &amp;&amp; v + 1 &lt; r.length &amp;&amp; 56320 === (64512 &amp; r.charCodeAt(v + 1)) ? (A = 65536 + ((1023 &amp; A) &lt;&lt; 10) + (1023 &amp; r.charCodeAt(++v)), S[c++] = A &gt;&gt; 18 | 240, S[c++] = A &gt;&gt; 12 &amp; 63 | 128) : S[c++] = A &gt;&gt; 12 | 224, S[c++] = A &gt;&gt; 6 &amp; 63 | 128), S[c++] = 63 &amp; A | 128)
    } for (var p = m, F = &quot;&quot; + String.fromCharCode(43) + String.fromCharCode(45) + String.fromCharCode(97) + (&quot;&quot; + String.fromCharCode(94) + String.fromCharCode(43) + String.fromCharCode(54)), D = &quot;&quot; + String.fromCharCode(43) + String.fromCharCode(45) + String.fromCharCode(51) + (&quot;&quot; + String.fromCharCode(94) + String.fromCharCode(43) + String.fromCharCode(98)) + (&quot;&quot; + String.fromCharCode(43) + String.fromCharCode(45) + String.fromCharCode(102)), b = 0; b &lt; S.length; b++)p += S[b], p = n(p, F);
    return p = n(p, D), p ^= s, 0 &gt; p &amp;&amp; (p = (2147483647 &amp; p) + 2147483648), p %= 1e6, p.toString() + &quot;.&quot; + (p ^ m)
}

function n(r, o) {
    for (var t = 0; t &lt; o.length - 2; t += 3) {
        var a = o.charAt(t + 2); a = a &gt;= &quot;a&quot; ? a.charCodeAt(0) - 87 : Number(a), a = &quot;+&quot; === o.charAt(t + 1) ? r &gt;&gt;&gt; a : r &lt;&lt; a, r = &quot;+&quot; === o.charAt(t) ? r + a &amp; 4294967295 : r ^ a
    } return r
}
&quot;&quot;&quot;


class TransMachine():
    def __init__(self):
        self.session = requests.session()

    def get_token_and_gtk(self):
        user_agent = &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4133.0 Safari/537.36 Edg/84.0.508.0&quot;
        headers = {
            'User-Agent': user_agent
        }
        res = self.session.get(&quot;https://www.baidu.com/&quot;, headers=headers)     # ç¥ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆè®¿é—®ç™¾åº¦é¦–é¡µå°±èƒ½é¿å…998
        print(res.cookies)
        url = 'https://fanyi.baidu.com/'
        res = self.session.get(url, headers=headers)
        print(res.cookies)
        res = res.text
        # fh = open('res.html', 'wb')
        # fh.write(res.encode())
        # fh.close()

        token = re.findall(&quot;token: '(.*?)'&quot;, res)[0]
        gtk = re.findall(&quot;.gtk = '(.*?)'&quot;, res)[0]

        return token, gtk


    def get_trans(self, words, token, sign):
        check_res = self.session.post(
            &quot;https://fanyi.baidu.com/langdetect&quot;, data={'query': words})
        check_json = json.loads(check_res.text)
        lan = check_json['lan']

        if lan == 'zh':
            lan_from = 'zh'
            lan_to = 'en'
        elif lan == 'en':
            lan_from = 'en'
            lan_to = 'zh'
        else:
            return 'è¯­è¨€æ£€æµ‹é”™è¯¯'

        url = 'https://fanyi.baidu.com/v2transapi'
        form_data = {
            'from': lan_from,
            'to': lan_to,
            'query': words,
            'transtype': 'realtime',
            'simple_means_flag': 3,
            'sign': sign,
            'token': token,
            'domain': 'common'
        }

        user_agent = &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4133.0 Safari/537.36 Edg/84.0.508.0&quot;
        headers = {
            'User-Agent': user_agent,
            'origin': 'https://fanyi.baidu.com',
            'referer': 'https://fanyi.baidu.com/'
        }

        res = self.session.post(url, data=form_data, headers=headers).content.decode()
        res_json = json.loads(res)
        res = res_json['trans_result']['data'][0]['dst']
        return 'ç¿»è¯‘ç»“æœï¼š' + res


if __name__ == '__main__':
    TM = TransMachine()
    token, gtk = TM.get_token_and_gtk()
    print('token:', token, 'gtk:', gtk)

    # æ–¹æ‹¬å·éœ€è¦åŠ \
    js_content = re.sub(r&quot;window\[l\]&quot;, '&quot;' + gtk + '&quot;', js_content)
    fh = open('res.js', 'w')
    fh.write(js_content)
    fh.close()
    fun = execjs.compile(js_content)

    while True:
        print('=========================================')
        words = input('è¾“å…¥è¦ç¿»è¯‘çš„å†…å®¹ï¼ˆä¸­æ–‡æˆ–è‹±æ–‡ï¼Œè¾“å…¥ç©ºç™½é€€å‡ºï¼‰:')
        if words == &quot;&quot;:
            break
        sign = fun.call('e', words)
        print(TM.get_trans( words, token, sign))
</code></pre>

<p>ä¸Šé¢ä¸ºäº†cookieèŠ±äº†è¶…çº§ä¹…çš„åŠŸå¤«ï¼Œä½†å®é™…ä¸Šï¼Œå¯ä»¥ç›´æ¥æ‰‹åŠ¨è®¿é—®ä¸€æ¬¡ï¼ŒæŠŠcookieå¤åˆ¶åˆ°ä»£ç é‡Œé¢ï¼Œçœ‹åˆ°è¿™ä¸ªåšæ³•ä¹‹åäººç›´æ¥å‚»äº†ğŸ™ƒ</p>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>Wanakiki </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://wanakiki.github.io/2020/baidufanyi/>https://wanakiki.github.io/2020/baidufanyi/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                æœ¬æ–‡é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://wanakiki.github.io/tags/python/">
                    #Python</a></span>
            
            <span class="tag"><a href="https://wanakiki.github.io/tags/%E7%88%AC%E8%99%AB/">
                    #çˆ¬è™«</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> Â· 
                <span><a href="https://wanakiki.github.io">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://wanakiki.github.io/2020/leetcode-spider/" class="prev" rel="prev" title="çˆ¬è™«è·å–åŠ›æ‰£é¢˜ç›®ä¿¡æ¯å¹¶è½¬ä¸ºMarkdown"><i class="iconfont icon-left"></i>&nbsp;çˆ¬è™«è·å–åŠ›æ‰£é¢˜ç›®ä¿¡æ¯å¹¶è½¬ä¸ºMarkdown</a>
         
        
        <a href="https://wanakiki.github.io/2020/mongodb-demo/" class="next" rel="next" title="Flask&#43;MongoDB CURDå¾®å®æˆ˜">Flask&#43;MongoDB CURDå¾®å®æˆ˜&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2020</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://wanakiki.github.io">Wanakiki</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
