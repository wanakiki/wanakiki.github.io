<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>ç™¾åº¦ç¿»è¯‘çˆ¬è™« - Wanakiki`s Blog</title><meta name="Description" content=""><meta property="og:title" content="ç™¾åº¦ç¿»è¯‘çˆ¬è™«" />
<meta property="og:description" content="å…¸å‹çš„jsåŠ å¯†çˆ¬è™«å®æˆ˜ï¼Œæœ¬æ–‡ç« å†…å®¹ä»…ä½œå­¦ä¹ äº¤æµã€‚ é¦–å…ˆæ”¾ä¸€ä¸‹å‚è€ƒæ–‡ç« ï¼šçˆ¬è™«JSç ´è§£ç»å…¸æ¡ˆä¾‹ä¹‹ç™¾åº¦ç¿»è¯‘ å¦‚æœæ²¡æœ‰è¿™ç¯‡æ–‡ç« çš„è¯ï¼Œæˆ‘å¯èƒ½è¦èŠ±å¾ˆå¤šåŠŸå¤«æ‰èƒ½æ‰¾åˆ°å…·ä½“çš„jsä»£ç ä½ç½®ã€‚ é¡µé¢åŠ è½½åˆ†æ åˆæ­¥æ¢ç´¢ æ‰“å¼€ç™¾åº¦ç¿»è¯‘ï¼Œ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://wanakiki.github.io/posts/baidufanyi/" />
<meta property="article:published_time" content="2020-05-18T20:44:50+08:00" />
<meta property="article:modified_time" content="2020-05-18T20:44:50+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ç™¾åº¦ç¿»è¯‘çˆ¬è™«"/>
<meta name="twitter:description" content="å…¸å‹çš„jsåŠ å¯†çˆ¬è™«å®æˆ˜ï¼Œæœ¬æ–‡ç« å†…å®¹ä»…ä½œå­¦ä¹ äº¤æµã€‚ é¦–å…ˆæ”¾ä¸€ä¸‹å‚è€ƒæ–‡ç« ï¼šçˆ¬è™«JSç ´è§£ç»å…¸æ¡ˆä¾‹ä¹‹ç™¾åº¦ç¿»è¯‘ å¦‚æœæ²¡æœ‰è¿™ç¯‡æ–‡ç« çš„è¯ï¼Œæˆ‘å¯èƒ½è¦èŠ±å¾ˆå¤šåŠŸå¤«æ‰èƒ½æ‰¾åˆ°å…·ä½“çš„jsä»£ç ä½ç½®ã€‚ é¡µé¢åŠ è½½åˆ†æ åˆæ­¥æ¢ç´¢ æ‰“å¼€ç™¾åº¦ç¿»è¯‘ï¼Œ"/>
<meta name="application-name" content="Wanakiki`s Blog">
<meta name="apple-mobile-web-app-title" content="Wanakiki`s Blog"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://wanakiki.github.io/posts/baidufanyi/" /><link rel="prev" href="https://wanakiki.github.io/posts/leetcode-spider/" /><link rel="next" href="https://wanakiki.github.io/posts/mongodb-demo/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "ç™¾åº¦ç¿»è¯‘çˆ¬è™«",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/wanakiki.github.io\/posts\/baidufanyi\/"
        },"genre": "posts","keywords": "Python, çˆ¬è™«","wordcount":  3393 ,
        "url": "https:\/\/wanakiki.github.io\/posts\/baidufanyi\/","datePublished": "2020-05-18T20:44:50+08:00","dateModified": "2020-05-18T20:44:50+08:00","publisher": {
            "@type": "Organization",
            "name": "wanakiki"},"author": {
                "@type": "Person",
                "name": "wanakiki"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Wanakiki`s Blog">Wanakiki`s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Blog </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Wanakiki`s Blog">Wanakiki`s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Blog</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">ç™¾åº¦ç¿»è¯‘çˆ¬è™«</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>wanakiki</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-05-18">2020-05-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 3393 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 7 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#é¡µé¢åŠ è½½åˆ†æ">é¡µé¢åŠ è½½åˆ†æ</a>
      <ul>
        <li><a href="#åˆæ­¥æ¢ç´¢">åˆæ­¥æ¢ç´¢</a></li>
        <li><a href="#æ·±å…¥æŒ–æ˜">æ·±å…¥æŒ–æ˜</a></li>
      </ul>
    </li>
    <li><a href="#jsç ´è§£">JSç ´è§£</a>
      <ul>
        <li><a href="#jsè°ƒè¯•">JSè°ƒè¯•</a></li>
        <li><a href="#pythonæ‰§è¡Œjsä»£ç ">Pythonæ‰§è¡ŒJSä»£ç </a></li>
      </ul>
    </li>
    <li><a href="#ä»£ç å®ç°">ä»£ç å®ç°</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>å…¸å‹çš„jsåŠ å¯†çˆ¬è™«å®æˆ˜ï¼Œæœ¬æ–‡ç« å†…å®¹ä»…ä½œå­¦ä¹ äº¤æµã€‚</p>
<!-- raw HTML omitted -->
<p>é¦–å…ˆæ”¾ä¸€ä¸‹å‚è€ƒæ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/76239929" target="_blank" rel="noopener noreffer">çˆ¬è™«JSç ´è§£ç»å…¸æ¡ˆä¾‹ä¹‹ç™¾åº¦ç¿»è¯‘</a></p>
<p>å¦‚æœæ²¡æœ‰è¿™ç¯‡æ–‡ç« çš„è¯ï¼Œæˆ‘å¯èƒ½è¦èŠ±å¾ˆå¤šåŠŸå¤«æ‰èƒ½æ‰¾åˆ°å…·ä½“çš„jsä»£ç ä½ç½®ã€‚</p>
<h2 id="é¡µé¢åŠ è½½åˆ†æ">é¡µé¢åŠ è½½åˆ†æ</h2>
<h3 id="åˆæ­¥æ¢ç´¢">åˆæ­¥æ¢ç´¢</h3>
<p>æ‰“å¼€<a href="https://fanyi.baidu.com/" target="_blank" rel="noopener noreffer">ç™¾åº¦ç¿»è¯‘</a>ï¼Œç„¶åå³é”®ã€æ£€æŸ¥ã€networkï¼Œåˆ·æ–°é¡µé¢å³å¯çœ‹åˆ°ç½‘é¡µçš„åŠ è½½è¿‡ç¨‹ã€‚å…·ä½“çš„å›¾ç¤ºå¯ä»¥åœ¨ä¹‹å‰çš„<a href="../leetcode-spider" rel="">leetcodeçˆ¬è™«</a>ä¸­æ‰¾åˆ°ã€‚</p>
<p>åœ¨è¾“å…¥ä»»æ„æŸ¥è¯¢å†…å®¹ç‚¹å‡»ç¿»è¯‘åï¼Œåœ¨<code>XHR</code>é¡¹ä¸­å¯ä»¥çœ‹åˆ°<code>langdetect</code>ã€<code>v2transapi?form &amp; to</code>ä¸¤ä¸ªè¯·æ±‚ã€‚æ£€æŸ¥å†…å®¹ä¸éš¾å‘ç°ï¼Œå‰è€…çš„ä½œç”¨æ˜¯è¯­è¨€æ£€æŸ¥ï¼Œ åè€…æ‰æ˜¯çœŸæ­£çš„ç¿»è¯‘ã€‚</p>
<pre><code class="language-no" data-lang="no">from: en
to: zh
query: hello everyone
transtype: translang
simple_means_flag: 3
sign: 58244.262325
token: 440bdb196410660e636b3223ebb83a94
domain: common
</code></pre><p>ä¸Šé¢æ˜¯æˆ‘ä»¥&quot;hello everyone&quot;ä½œä¸ºå¾…ç¿»è¯‘æ–‡æœ¬å‘èµ·è¯·æ±‚çš„è¡¨å•å†…å®¹ï¼Œ<code>from</code>ã€<code>to</code>ã€<code>query</code>è¿™ä¸‰é¡¹æ„ä¹‰å¾ˆæ˜ç¡®ï¼Œå…¶ä½™é¡¹æ— æ³•ç›´æ¥åˆ¤æ–­å‡ºå…·ä½“çš„ä½œç”¨ã€‚</p>
<h3 id="æ·±å…¥æŒ–æ˜">æ·±å…¥æŒ–æ˜</h3>
<p>å¤šè¾“å…¥å‡ ç»„æ•°æ®ï¼Œå¯ä»¥å‘ç°<code>sign</code>ä¼šéšç€<code>query</code>çš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œè€Œ<code>token</code>é¡¹å´ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚</p>
<p>è¿™é‡Œæˆ‘å‚è€ƒäº†åˆ«äººçš„æ–¹å¼ï¼Œæœç´¢&quot;sign:&ldquo;å¾ˆå¿«æ‰¾åˆ°äº†è¿™ä¸ªè¯·æ±‚çš„å‘èµ·ä»£ç ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">h</span><span class="o">=</span><span class="p">{</span><span class="nx">from</span><span class="o">:</span><span class="nx">p</span><span class="p">.</span><span class="nx">fromLang</span><span class="p">,</span><span class="nx">to</span><span class="o">:</span><span class="nx">p</span><span class="p">.</span><span class="nx">toLang</span><span class="p">,</span><span class="nx">query</span><span class="o">:</span><span class="nx">n</span><span class="p">,</span><span class="nx">transtype</span><span class="o">:</span><span class="nx">r</span><span class="p">,</span><span class="nx">simple_means_flag</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">sign</span><span class="o">:</span><span class="nx">y</span><span class="p">(</span><span class="nx">n</span><span class="p">),</span><span class="nx">token</span><span class="o">:</span><span class="nb">window</span><span class="p">.</span><span class="nx">common</span><span class="p">.</span><span class="nx">token</span><span class="p">,</span><span class="nx">domain</span><span class="o">:</span><span class="nx">w</span><span class="p">.</span><span class="nx">getCurDomain</span><span class="p">()}</span>
</code></pre></div><p>å¦å¤–è¿™é‡Œçš„<code>token</code>ä¹Ÿå¯ä»¥é€šè¿‡æœç´¢&quot;window[&lsquo;common&rsquo;]&ldquo;æ‰¾åˆ°ï¼Œå‘ç°ä»–å…¶å®ä½äºhtmlä»£ç ä¸­ï¼Œæ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œå¯ä»¥ç›´æ¥ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£æhtmlä»£ç è·å–ã€‚æ‰€ä»¥ç°åœ¨éœ€è¦è§£å†³çš„é—®é¢˜å°±æ˜¯<code>sign</code>çš„äº§ç”Ÿã€‚</p>
<h2 id="jsç ´è§£">JSç ´è§£</h2>
<p><code>sign</code>é€šè¿‡yå‡½æ•°äº§ç”Ÿï¼Œå¦å¤–é€šè¿‡è§‚å¯Ÿå¯ä»¥å‘ç°yå‡½æ•°çš„ä¼ å‚å®é™…ä¸Šæ˜¯å¾…æŸ¥è¯¢çš„å†…å®¹ï¼Œæ‰€ä»¥åªè¦æ‰¾åˆ°yå‡½æ•°ï¼Œç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥è·å¾—ä»»æ„è¾“å…¥çš„<code>sign</code>å€¼ã€‚é‚£ä¹ˆæ€ä¹ˆæ‰èƒ½æ‰¾åˆ°yå‡½æ•°å‘¢ï¼Ÿç¬¬ä¸€ä¸ªæƒ³æ³•å½“ç„¶æ˜¯ç»§ç»­æœç´¢ï¼Œä½†å®é™…ä¸Šä¸€æœç´¢å°±ä¼šå‘ç°ï¼Œå› ä¸ºç‰¹å¾å¤ªå°‘æ— æ³•ç¡®å®šå…·ä½“æ˜¯å“ªä¸€ä¸ªæœç´¢ç»“æœã€‚è¿™é‡Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªå¾ˆå…³é”®çš„æŠ€æœ¯ï¼š<code>JSè°ƒè¯•</code>ã€‚</p>
<h3 id="jsè°ƒè¯•">JSè°ƒè¯•</h3>
<p>å…ˆè¯´ä¸€ä¸‹è°ƒè¯•çš„å…·ä½“æ­¥éª¤ï¼Œå¦‚æœæ²¡æœ‰ç›¸å…³åŸºç¡€çš„è¯ç›´æ¥ä¸Šæ‰‹è¿˜æ˜¯ä¼šæœ‰ç‚¹é—®é¢˜çš„ã€‚</p>
<p>é¦–å…ˆæ‰¾åˆ°ä»£ç æ‰€åœ¨è¡Œï¼Œå¯¹äºå¤æ‚ç½‘é¡µï¼Œä¸€è¡Œå†…å¯èƒ½æœ‰å¤šæ¡è¯­å¥ï¼Œè¿™æ—¶å€™å¦‚æœç›´æ¥ç‚¹å‡»æƒ³è¦è°ƒè¯•çš„å‡½æ•°çš„è¯ï¼Œå®é™…ä¸Šä¸ä¼šæ·»åŠ æ–­ç‚¹ã€‚æ­£ç¡®çš„æ“ä½œåº”è¯¥æ˜¯åƒPythonä»£ç é‚£æ ·ï¼Œå…ˆç‚¹å‡»è¿™ä¸€è¡Œçš„æœ€å·¦ä¾§çš„è¡Œå·ï¼Œç‚¹å‡»è¡Œå·ä¹‹ååœ¨æŠŠé¼ æ ‡ç§»åŠ¨åˆ°æƒ³è¦è°ƒè¯•çš„å‡½æ•°ä¸Šï¼Œè¿™æ—¶å€™ä¼šå‘ç°å‡½æ•°å¯ä»¥è¢«ç‚¹å‡»ï¼Œç‚¹å‡»å‡½æ•°åä¾¿èƒ½æ·»åŠ æ–­ç‚¹ã€‚ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ç‚¹å‡»ä»£ç æ¡†å·¦ä¸‹è§’çš„èŠ±æ‹¬å·ï¼Œç›´æ¥æŠŠä»£ç æ ¼å¼åŒ–ï¼Œæˆ‘å½“æ—¶æ‰¾äº†å¾ˆä¹…æ²¡æ‰¾åˆ°ğŸ˜£ï¼‰</p>
<p>åœ¨æ·»åŠ å®Œæ–­ç‚¹ä¹‹åï¼Œç»§ç»­è¾“å…¥å†…å®¹ï¼Œç‚¹å‡»ç¿»è¯‘ï¼Œå¯ä»¥å‘ç°ç½‘ç«™åœæ­¢åŠ è½½ï¼Œå¹¶ä¸”è¿”å›è°ƒè¯•ç•Œé¢å¯ä»¥çœ‹åˆ°å˜é‡ååŠå…¶å¯¹åº”çš„å€¼ï¼Œå°†é¼ æ ‡æ”¾åˆ°å‡½æ•°åä¸Šå¯ä»¥è·³è½¬åˆ°å‡½æ•°çš„å…·ä½“ä½ç½®ï¼Œè¿™æ ·å°±èƒ½æ‰¾åˆ°yå‡½æ•°çš„çœŸæ­£ä½ç½®äº†ã€‚å…¶å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">e</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/[\uD800-\uDBFF][\uDC00-\uDFFF]/g</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">===</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
        <span class="nx">t</span> <span class="o">&gt;</span> <span class="mi">30</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">r</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">r</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="nx">r</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">t</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="nx">r</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/[\uD800-\uDBFF][\uDC00-\uDFFF]/</span><span class="p">),</span> <span class="nx">C</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">f</span> <span class="o">=</span> <span class="p">[];</span> <span class="nx">h</span> <span class="o">&gt;</span> <span class="nx">C</span><span class="p">;</span> <span class="nx">C</span><span class="o">++</span><span class="p">)</span><span class="s2">&#34;&#34;</span> <span class="o">!==</span> <span class="nx">e</span><span class="p">[</span><span class="nx">C</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">a</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="nx">C</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">))),</span> <span class="nx">C</span> <span class="o">!==</span> <span class="nx">h</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">C</span><span class="p">]);</span>
        <span class="kd">var</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">g</span> <span class="o">&gt;</span> <span class="mi">30</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">r</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">f</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">g</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">g</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">f</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>   <span class="c1">// ç›´æ¥æ‰§è¡Œä¼šæç¤ºiæ²¡æœ‰å®šä¹‰ æ‰€ä»¥åŠ äº†ä¸€è¡Œ
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">u</span> <span class="o">=</span> <span class="k">void</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">103</span><span class="p">)</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">116</span><span class="p">)</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">107</span><span class="p">);</span> 
    <span class="nx">u</span> <span class="o">=</span> <span class="kc">null</span> <span class="o">!==</span> <span class="nx">i</span> <span class="o">?</span> <span class="nx">i</span> <span class="o">:</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nb">window</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">u</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">),</span> <span class="nx">m</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">s</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">S</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">v</span> <span class="o">&lt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">v</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">A</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span> <span class="mi">128</span> <span class="o">&gt;</span> <span class="nx">A</span> <span class="o">?</span> <span class="nx">S</span><span class="p">[</span><span class="nx">c</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">A</span> <span class="o">:</span> <span class="p">(</span><span class="mi">2048</span> <span class="o">&gt;</span> <span class="nx">A</span> <span class="o">?</span> <span class="nx">S</span><span class="p">[</span><span class="nx">c</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">A</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span> <span class="o">|</span> <span class="mi">192</span> <span class="o">:</span> <span class="p">(</span><span class="mi">55296</span> <span class="o">===</span> <span class="p">(</span><span class="mi">64512</span> <span class="o">&amp;</span> <span class="nx">A</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">v</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="mi">56320</span> <span class="o">===</span> <span class="p">(</span><span class="mi">64512</span> <span class="o">&amp;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">?</span> <span class="p">(</span><span class="nx">A</span> <span class="o">=</span> <span class="mi">65536</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1023</span> <span class="o">&amp;</span> <span class="nx">A</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1023</span> <span class="o">&amp;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="o">++</span><span class="nx">v</span><span class="p">)),</span> <span class="nx">S</span><span class="p">[</span><span class="nx">c</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">A</span> <span class="o">&gt;&gt;</span> <span class="mi">18</span> <span class="o">|</span> <span class="mi">240</span><span class="p">,</span> <span class="nx">S</span><span class="p">[</span><span class="nx">c</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">A</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span> <span class="o">&amp;</span> <span class="mi">63</span> <span class="o">|</span> <span class="mi">128</span><span class="p">)</span> <span class="o">:</span> <span class="nx">S</span><span class="p">[</span><span class="nx">c</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">A</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span> <span class="o">|</span> <span class="mi">224</span><span class="p">,</span> <span class="nx">S</span><span class="p">[</span><span class="nx">c</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">A</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span> <span class="o">&amp;</span> <span class="mi">63</span> <span class="o">|</span> <span class="mi">128</span><span class="p">),</span> <span class="nx">S</span><span class="p">[</span><span class="nx">c</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="mi">63</span> <span class="o">&amp;</span> <span class="nx">A</span> <span class="o">|</span> <span class="mi">128</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">F</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">43</span><span class="p">)</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">94</span><span class="p">)</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">43</span><span class="p">)</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">54</span><span class="p">)),</span> <span class="nx">D</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">43</span><span class="p">)</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">51</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">94</span><span class="p">)</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">43</span><span class="p">)</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">98</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">43</span><span class="p">)</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mi">102</span><span class="p">)),</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">b</span> <span class="o">&lt;</span> <span class="nx">S</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">b</span><span class="o">++</span><span class="p">)</span><span class="nx">p</span> <span class="o">+=</span> <span class="nx">S</span><span class="p">[</span><span class="nx">b</span><span class="p">],</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">n</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">F</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">n</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">D</span><span class="p">),</span> <span class="nx">p</span> <span class="o">^=</span> <span class="nx">s</span><span class="p">,</span> <span class="mi">0</span> <span class="o">&gt;</span> <span class="nx">p</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">p</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2147483647</span> <span class="o">&amp;</span> <span class="nx">p</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2147483648</span><span class="p">),</span> <span class="nx">p</span> <span class="o">%=</span> <span class="mi">1</span><span class="nx">e6</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&#34;.&#34;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">p</span> <span class="o">^</span> <span class="nx">m</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ°è¿™æ®µä»£ç è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå¦‚æœæ‡‚jsçš„è¯ï¼Œå¯ä»¥ç¨å¾®è§£è¯»ä¸€ä¸‹ï¼Œå› ä¸ºè¿™æ®µä»£ç è¿˜æ²¡æœ‰æ··æ·†åˆ°å®Œå…¨æ²¡åŠæ³•çœ‹çš„ç¨‹åº¦ï¼ˆæŠŠæ‰€æœ‰çš„å­—ç¬¦éƒ½ç”¨æ‹¬å·æˆ–è€…ä¸‹åˆ’çº¿ä¹‹ç±»çš„æ›¿ä»£ï¼‰ã€‚</p>
<p>è¿™é‡Œè®²ä¸‰ä¸ªåç»­æ‰§è¡Œä»£ç çš„æ—¶å€™æ‰ä¼šå‘ç°çš„ç‚¹ï¼š</p>
<ol>
<li>ä»£ç ä½¿ç”¨äº†å…¨å±€çš„<code>window</code>å˜é‡ï¼Œjså‡½æ•°å½“ä¸­æœªä½œå®šä¹‰ï¼Œé€šè¿‡è°ƒè¯•å¯ä»¥å‘ç°å®é™…ä¸Šæ˜¯ä¸ºäº†è·å–è¯¥å˜é‡çš„<code>gtk</code>å€¼ï¼Œè¯¥å€¼ä¹Ÿæ˜¯å†™åœ¨htmlå½“ä¸­çš„ï¼Œå¯ä»¥ç›´æ¥æ­£åˆ™è·å¾—ï¼Œè·å¾—ä¹‹åå¯¹jsä»£ç è¿›è¡Œç¨å¾®ä¿®æ”¹å³å¯ã€‚</li>
<li>iå˜é‡æœªå®šä¹‰ï¼Œæ²¡æœ‰æ‰¾åˆ°iå˜é‡çš„å…·ä½“ä½ç½®ï¼Œä½†æ˜¯æŸ¥çœ‹ä¹‹åå…¶æ²¡æœ‰å¾ˆçªå‡ºçš„ä½œç”¨ï¼Œäºæ˜¯è‡ªå·±åŠ äº†ä¸€æ¡è¯­å¥ï¼Œå¯¹iå˜é‡è¿›è¡Œäº†å®šä¹‰ã€‚</li>
<li>å‡½æ•°å†…éƒ¨è°ƒç”¨äº†å¦å¤–çš„å‡½æ•°nğŸ˜‘ï¼Œå…·ä½“çš„è°ƒç”¨å¯ä»¥åœ¨å‡½æ•°çš„returnä½ç½®ï¼Œå¦‚æœä¸ä»”ç»†çœ‹è¿‡ï¼Œç¬¬ä¸€éæ˜¯ä¸ä¼šå‘ç°è¿™ä¸ªç‚¹çš„ã€‚æ‰¾åˆ°nçš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥æ‰“æ–­ç‚¹å°±å¥½äº†ï¼Œè¿™é‡Œä¸åšè¯¦ç»†è§£é‡Šã€‚nçš„ä»£ç ä¼šåœ¨æœ€åç»™å‡ºã€‚</li>
</ol>
<h3 id="pythonæ‰§è¡Œjsä»£ç ">Pythonæ‰§è¡ŒJSä»£ç </h3>
<p>å‰é¢æˆ‘ä»¬å·²ç»è·å¾—äº†<code>sign</code>ç”Ÿæˆå‡½æ•°çš„å…·ä½“ä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬çš„çˆ¬è™«è¯­è¨€æ˜¯Pythonï¼Œå¦‚æœæŠŠjsä»£ç ç¿»è¯‘æˆPythonå°±å¤ªéº»çƒ¦äº†ï¼Œè¿˜å¥½æœ‰å·²ç»å°è£…å¥½çš„ç¬¬ä¸‰æ–¹åº“å¯ä»¥æ‰§è¡Œã€‚</p>
<p>èƒ½å¤Ÿå®ç°ä¸Šè¿°åŠŸèƒ½çš„ç¬¬ä¸‰æ–¹åº“æœ‰å¾ˆå¤šï¼Œæˆ‘è¿™é‡Œä½¿ç”¨äº†<code>pyexecjs</code>ï¼Œéœ€è¦æ³¨æ„è¯¥æ¨¡å—éœ€è¦å®‰è£…node.jsé…åˆä½¿ç”¨ã€‚å‡è®¾æˆ‘ä»¬å·²ç»æŠŠç”Ÿæˆå‡½æ•°æ”¾åœ¨äº†fanyi.jså½“ä¸­ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼è¿›è¡Œè°ƒç”¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">execjs</span>

<span class="n">query</span> <span class="o">=</span> <span class="s2">&#34;å¾…ç¿»è¯‘è¯­å¥&#34;</span>
<span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;fanyi.js&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">fun</span> <span class="o">=</span> <span class="n">execjs</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">fun</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="n">query</span><span class="p">))</span>
</code></pre></div><h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<p>åœ¨åšå®Œå‰é¢çš„å‡†å¤‡å·¥ä½œä¹‹åï¼Œä¾¿èƒ½å¼€å§‹å…·ä½“çš„ä»£ç ä¹¦å†™ï¼Œæ•´ä½“æ€è·¯å¦‚ä¸‹ï¼š</p>
<ol>
<li>è¯·æ±‚ç™¾åº¦ç¿»è¯‘é¦–é¡µ</li>
<li>è§£æhtmlè·å¾—<code>token</code>ã€<code>gtk</code></li>
<li>ç”¨å¾—åˆ°çš„<code>gkt</code>æ›¿æ¢jsä»£ç ä¸­çš„å¯¹åº”å†…å®¹</li>
<li>ç¼–è¯‘jsä»£ç å¹¶æ‰§è¡Œï¼Œè·å¾—<code>sign</code></li>
<li>è¯·æ±‚å…·ä½“çš„è¯­è¨€æ£€æµ‹ã€ç¿»è¯‘ç½‘å€ï¼Œå¾—åˆ°ç»“æœ</li>
</ol>
<p>åœ¨å®ç°çˆ¬è™«æ—¶ï¼Œæˆ‘åˆå¯¹æŸ¥è¯¢è¯·æ±‚åšäº†è¿›ä¸€æ­¥åˆ†æï¼Œå‘ç°åœ¨æäº¤çš„ä¼—å¤šcookieå½“ä¸­ï¼Œæœ€å…³é”®çš„æ˜¯<code>BAIDUID</code>è¿™ä¸€é¡¹ï¼Œè€Œè®¿é—®ç™¾åº¦ç¿»è¯‘é¦–é¡µåˆšå¥½å¯ä»¥è·å¾—è¿™ä¸ªcookieã€‚</p>
<p>è¿™æ ·ä¾¿èƒ½ç›´æ¥ç”¨ä¸€ä¸ªsessionï¼Œå…ˆè®¿é—®ç™¾åº¦ç¿»è¯‘é¦–é¡µï¼Œè·å¾—cookieçš„åŒæ—¶è§£æhtmlå¾—åˆ°<code>token</code>å’Œ<code>gtk</code>ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œã€‚åˆ°è¿™é‡Œä»£ç å·²ç»å¾ˆæ¸…æ™°äº†ï¼Œä½†æ˜¯å†™å®Œä¹‹åå´å‘ç°ä¸èƒ½æˆåŠŸæ‰§è¡Œï¼ŒæœåŠ¡ç«¯æŠ¥é”™998ğŸ˜­</p>
<p>çœ‹åˆ°é”™è¯¯ä¹‹åä»¥ä¸ºæ˜¯jsä»£ç å‡ºäº†é—®é¢˜ï¼Œè°ƒæ•´äº†å¾ˆä¹…ï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯ä¸è¡Œï¼Œäºæ˜¯åˆæ±‚åŠ©äº†ç™¾åº¦ï¼Œåœ¨<a href="https://www.cnblogs.com/jason-Gan/p/10567018.html" target="_blank" rel="noopener noreffer">è¿™é‡Œ</a>æ‰¾åˆ°äº†ä¸€ä¸ªè§£å†³åŠæ³•ï¼Œå…ˆè®¿é—®ä¸€ä¸‹ç™¾åº¦é¦–é¡µï¼Œå¸¦ç€ç™¾åº¦é¦–é¡µçš„cookieè®¿é—®ç™¾åº¦ç¿»è¯‘ï¼Œè¿™æ ·å°±ä¸ä¼šæŠ¥é”™ã€‚</p>
<p>å…·ä½“çš„åŸç†æˆ‘åˆ°ç°åœ¨è¿˜ä¸æ¸…æ¥šï¼Œæˆ‘ä¹‹å‰è¿›è¡Œæµ‹è¯•çš„æ—¶å€™ï¼Œå¦‚æœä¸å…ˆè®¿é—®ç™¾åº¦é¦–é¡µçš„è¯ï¼Œè®¿é—®ç™¾åº¦ç¿»è¯‘è§£æå‡ºæ¥çš„<code>token</code>æ˜¯ä¸€ä¸ªä¸€æˆä¸å˜çš„å€¼ï¼Œæˆ‘èµ·åˆè®¤ä¸ºæ˜¯jsä»£ç æœ‰é”™è¯¯ï¼Œå°±ä¸€ç›´è¿›è¡Œäº†æµ‹è¯•ï¼ŒåŠä¸ªå¤šå°æ—¶<code>token</code>çš„å€¼éƒ½æ²¡æœ‰å˜åŒ–ã€‚<code>token</code>æ˜¯åœ¨htmlå½“ä¸­å†™æ­»çš„ï¼Œæœ‰é—®é¢˜åªèƒ½å‡ºåœ¨æœåŠ¡ç«¯ä¸Šï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºå…ˆè®¿é—®ç™¾åº¦é¦–é¡µçš„ç›®çš„å°±æ˜¯åœ¨è®¿é—®ç™¾åº¦ç¿»è¯‘çš„æ—¶å€™å¸¦ç€ä¸€ä¸ªcookieï¼Œè®©æœåŠ¡å™¨è¿”å›htmlçš„æ—¶å€™ç”Ÿæˆæ­£ç¡®çš„<code>token</code>ã€‚è‡³äºå…·ä½“æ˜¯ä¸æ˜¯è¿™ä¸ªåŸå› ï¼Œç­‰å­¦çš„æ›´å¤šäº†æ‰çŸ¥é“ã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘çš„ä»£ç ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">execjs</span>
<span class="kn">import</span> <span class="nn">json</span>


<span class="n">js_content</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&#34;&#34;&#34;function e(r) {
</span><span class="s2">    var o = r.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g);
</span><span class="s2">    if (null === o) {
</span><span class="s2">        var t = r.length;
</span><span class="s2">        t &gt; 30 &amp;&amp; (r = &#34;&#34; + r.substr(0, 10) + r.substr(Math.floor(t / 2) - 5, 10) + r.substr(-10, 10))
</span><span class="s2">    } else {
</span><span class="s2">        for (var e = r.split(/[\uD800-\uDBFF][\uDC00-\uDFFF]/), C = 0, h = e.length, f = []; h &gt; C; C++)&#34;&#34; !== e[C] &amp;&amp; f.push.apply(f, a(e[C].split(&#34;&#34;))), C !== h - 1 &amp;&amp; f.push(o[C]);
</span><span class="s2">        var g = f.length; g &gt; 30 &amp;&amp; (r = f.slice(0, 10).join(&#34;&#34;) + f.slice(Math.floor(g / 2) - 5, Math.floor(g / 2) + 5).join(&#34;&#34;) + f.slice(-10).join(&#34;&#34;))
</span><span class="s2">    }
</span><span class="s2">    var i = null 
</span><span class="s2">    var u = void 0, l = &#34;&#34; + String.fromCharCode(103) + String.fromCharCode(116) + String.fromCharCode(107); 
</span><span class="s2">    u = null !== i ? i : (i = window[l] || &#34;&#34;) || &#34;&#34;;
</span><span class="s2">    for (var d = u.split(&#34;.&#34;), m = Number(d[0]) || 0, s = Number(d[1]) || 0, S = [], c = 0, v = 0; v &lt; r.length; v++) {
</span><span class="s2">        var A = r.charCodeAt(v); 128 &gt; A ? S[c++] = A : (2048 &gt; A ? S[c++] = A &gt;&gt; 6 | 192 : (55296 === (64512 &amp; A) &amp;&amp; v + 1 &lt; r.length &amp;&amp; 56320 === (64512 &amp; r.charCodeAt(v + 1)) ? (A = 65536 + ((1023 &amp; A) &lt;&lt; 10) + (1023 &amp; r.charCodeAt(++v)), S[c++] = A &gt;&gt; 18 | 240, S[c++] = A &gt;&gt; 12 &amp; 63 | 128) : S[c++] = A &gt;&gt; 12 | 224, S[c++] = A &gt;&gt; 6 &amp; 63 | 128), S[c++] = 63 &amp; A | 128)
</span><span class="s2">    } for (var p = m, F = &#34;&#34; + String.fromCharCode(43) + String.fromCharCode(45) + String.fromCharCode(97) + (&#34;&#34; + String.fromCharCode(94) + String.fromCharCode(43) + String.fromCharCode(54)), D = &#34;&#34; + String.fromCharCode(43) + String.fromCharCode(45) + String.fromCharCode(51) + (&#34;&#34; + String.fromCharCode(94) + String.fromCharCode(43) + String.fromCharCode(98)) + (&#34;&#34; + String.fromCharCode(43) + String.fromCharCode(45) + String.fromCharCode(102)), b = 0; b &lt; S.length; b++)p += S[b], p = n(p, F);
</span><span class="s2">    return p = n(p, D), p ^= s, 0 &gt; p &amp;&amp; (p = (2147483647 &amp; p) + 2147483648), p %= 1e6, p.toString() + &#34;.&#34; + (p ^ m)
</span><span class="s2">}
</span><span class="s2">
</span><span class="s2">function n(r, o) {
</span><span class="s2">    for (var t = 0; t &lt; o.length - 2; t += 3) {
</span><span class="s2">        var a = o.charAt(t + 2); a = a &gt;= &#34;a&#34; ? a.charCodeAt(0) - 87 : Number(a), a = &#34;+&#34; === o.charAt(t + 1) ? r &gt;&gt;&gt; a : r &lt;&lt; a, r = &#34;+&#34; === o.charAt(t) ? r + a &amp; 4294967295 : r ^ a
</span><span class="s2">    } return r
</span><span class="s2">}
</span><span class="s2">&#34;&#34;&#34;</span>


<span class="k">class</span> <span class="nc">TransMachine</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_token_and_gtk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user_agent</span> <span class="o">=</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4133.0 Safari/537.36 Edg/84.0.508.0&#34;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">user_agent</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;https://www.baidu.com/&#34;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>     <span class="c1"># ç¥ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆè®¿é—®ç™¾åº¦é¦–é¡µå°±èƒ½é¿å…998</span>
        <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">cookies</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://fanyi.baidu.com/&#39;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">cookies</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span>
        <span class="c1"># fh = open(&#39;res.html&#39;, &#39;wb&#39;)</span>
        <span class="c1"># fh.write(res.encode())</span>
        <span class="c1"># fh.close()</span>

        <span class="n">token</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&#34;token: &#39;(.*?)&#39;&#34;</span><span class="p">,</span> <span class="n">res</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">gtk</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&#34;.gtk = &#39;(.*?)&#39;&#34;</span><span class="p">,</span> <span class="n">res</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">token</span><span class="p">,</span> <span class="n">gtk</span>


    <span class="k">def</span> <span class="nf">get_trans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">sign</span><span class="p">):</span>
        <span class="n">check_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&#34;https://fanyi.baidu.com/langdetect&#34;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">words</span><span class="p">})</span>
        <span class="n">check_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">check_res</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">lan</span> <span class="o">=</span> <span class="n">check_json</span><span class="p">[</span><span class="s1">&#39;lan&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">lan</span> <span class="o">==</span> <span class="s1">&#39;zh&#39;</span><span class="p">:</span>
            <span class="n">lan_from</span> <span class="o">=</span> <span class="s1">&#39;zh&#39;</span>
            <span class="n">lan_to</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span>
        <span class="k">elif</span> <span class="n">lan</span> <span class="o">==</span> <span class="s1">&#39;en&#39;</span><span class="p">:</span>
            <span class="n">lan_from</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span>
            <span class="n">lan_to</span> <span class="o">=</span> <span class="s1">&#39;zh&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;è¯­è¨€æ£€æµ‹é”™è¯¯&#39;</span>

        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://fanyi.baidu.com/v2transapi&#39;</span>
        <span class="n">form_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="n">lan_from</span><span class="p">,</span>
            <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="n">lan_to</span><span class="p">,</span>
            <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">words</span><span class="p">,</span>
            <span class="s1">&#39;transtype&#39;</span><span class="p">:</span> <span class="s1">&#39;realtime&#39;</span><span class="p">,</span>
            <span class="s1">&#39;simple_means_flag&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;sign&#39;</span><span class="p">:</span> <span class="n">sign</span><span class="p">,</span>
            <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span>
            <span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="s1">&#39;common&#39;</span>
        <span class="p">}</span>

        <span class="n">user_agent</span> <span class="o">=</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4133.0 Safari/537.36 Edg/84.0.508.0&#34;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">user_agent</span><span class="p">,</span>
            <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;https://fanyi.baidu.com&#39;</span><span class="p">,</span>
            <span class="s1">&#39;referer&#39;</span><span class="p">:</span> <span class="s1">&#39;https://fanyi.baidu.com/&#39;</span>
        <span class="p">}</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">form_data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="n">res_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res_json</span><span class="p">[</span><span class="s1">&#39;trans_result&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dst&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39;ç¿»è¯‘ç»“æœï¼š&#39;</span> <span class="o">+</span> <span class="n">res</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">TM</span> <span class="o">=</span> <span class="n">TransMachine</span><span class="p">()</span>
    <span class="n">token</span><span class="p">,</span> <span class="n">gtk</span> <span class="o">=</span> <span class="n">TM</span><span class="o">.</span><span class="n">get_token_and_gtk</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;token:&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s1">&#39;gtk:&#39;</span><span class="p">,</span> <span class="n">gtk</span><span class="p">)</span>

    <span class="c1"># æ–¹æ‹¬å·éœ€è¦åŠ \</span>
    <span class="n">js_content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;window\[l\]&#34;</span><span class="p">,</span> <span class="s1">&#39;&#34;&#39;</span> <span class="o">+</span> <span class="n">gtk</span> <span class="o">+</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">,</span> <span class="n">js_content</span><span class="p">)</span>
    <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;res.js&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">js_content</span><span class="p">)</span>
    <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">fun</span> <span class="o">=</span> <span class="n">execjs</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">js_content</span><span class="p">)</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;=========================================&#39;</span><span class="p">)</span>
        <span class="n">words</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;è¾“å…¥è¦ç¿»è¯‘çš„å†…å®¹ï¼ˆä¸­æ–‡æˆ–è‹±æ–‡ï¼Œè¾“å…¥ç©ºç™½é€€å‡ºï¼‰:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">words</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="n">fun</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">TM</span><span class="o">.</span><span class="n">get_trans</span><span class="p">(</span> <span class="n">words</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">sign</span><span class="p">))</span>
</code></pre></div><p>ä¸Šé¢ä¸ºäº†cookieèŠ±äº†è¶…çº§ä¹…çš„åŠŸå¤«ï¼Œä½†å®é™…ä¸Šï¼Œå¯ä»¥ç›´æ¥æ‰‹åŠ¨è®¿é—®ä¸€æ¬¡ï¼ŒæŠŠcookieå¤åˆ¶åˆ°ä»£ç é‡Œé¢ï¼Œçœ‹åˆ°è¿™ä¸ªåšæ³•ä¹‹åäººç›´æ¥å‚»äº†ğŸ™ƒ</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2020-05-18</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/python/">python</a>,&nbsp;<a href="/tags/%E7%88%AC%E8%99%AB/">çˆ¬è™«</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/leetcode-spider/" class="prev" rel="prev" title="çˆ¬è™«è·å–åŠ›æ‰£é¢˜ç›®ä¿¡æ¯å¹¶è½¬ä¸ºMarkdown"><i class="fas fa-angle-left fa-fw"></i>çˆ¬è™«è·å–åŠ›æ‰£é¢˜ç›®ä¿¡æ¯å¹¶è½¬ä¸ºMarkdown</a>
            <a href="/posts/mongodb-demo/" class="next" rel="next" title="Flask&#43;MongoDB CURDå¾®å®æˆ˜">Flask&#43;MongoDB CURDå¾®å®æˆ˜<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.75.1">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">wanakiki</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":10},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
